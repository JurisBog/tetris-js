var m=null; window.g=function(e){var i=[{b:"#f00",a:[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:1}]},{b:"#0f0",a:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:-1,y:0}]},{b:"#00f",a:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}]},{b:"#ff0",a:[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:-1,y:1}]},{b:"#fff",a:[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:1,y:1}]},{b:"#0ff",a:[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:-1,y:0}]},{b:"#f0f",a:[{x:0,y:0},{x:0,y:1},{x:-1,y:1},{x:1,y:0}]}],f=m,p={A:"#000",put:function(a){var b=f.j;typeof a==="undefined"?(a=this.A,f.f.c.clearRect(this.x, this.y,b,b),this.empty=!0):(this.empty=!1,f.f.B(this.x,this.y,b,b,a));this.b=a}},d={o:600,k:700,j:30,i:14,N:5,M:5,w:function(){var a=this.f,b=d.j*d.i;this.D=b+15;this.C=this.o-b-25;a.v(5,5,b,this.k-10);a.v(b+10,5,this.o-b-15,this.k-10);a.c.textAlign="left";a.s("NextPiece",b+25,30);a.c.textAlign="end"},Q:function(){var a=this.p,b=[],c=0;a.forEach(function(a,k){a.every(function(a){return!a.empty})?c+=k+1:b.push(a)});b.forEach(function(b,c){a[c].forEach(function(a,c){var j=b[c];j.empty?a.put():a.put(j.b)})}); a.slice(b.length).forEach(function(a){a.forEach(function(a){a.put()})});this.h+=c;this.P()},P:function(){this.u(this.h)},n:function(){var a=!0;this.m(0,-1)||(this.d.a.some(function(a){return a.y>=23})?(clearTimeout(this.S),alert("game over")):this.r(),a=!1);return a},q:function(){var a=e.floor(e.random()*i.length),b=this.e,c=this.L;b!=m&&b.a.forEach(function(a){c[a.y+2][a.x+2].put()});this.e=i[a];var n=this.e.b;this.e.a.forEach(function(a){c[a.y+2][a.x+2].put(n)});return b},r:function(){var a=this.q(), a={z:a,a:a.a.map(function(a){return{x:a.x+7,y:a.y+23}})};f.d=a;this.Q()},t:function(a){var b=this.d,c=b.a,n=f.p,e=f.i,d;if(a.every(function(a){return a.y>=0&&a.x>=0&&a.x<e&&(a.y>=23||n[a.y][a.x].empty||c.some(function(b){return a.x===b.x&&a.y===b.y}))})){d=c.filter(function(b){return a.every(function(a){return!(a.x===b.x&&a.y===b.y)})});var h=a.filter(function(a){return c.every(function(b){return!(b.x===a.x&&b.y===a.y)})});d.forEach(function(a){a.y<23&&n[a.y][a.x].put()});h.forEach(function(a){a.y< 23&&n[a.y][a.x].put(b.z.b)});b.a=a;d=!0}else d=!1;return d},m:function(a,b){return this.t(this.d.a.map(function(c){return{x:c.x+a,y:c.y+b}}))},R:function(){this.q();this.r();g.l()},J:function(){this.m(-1,0)},K:function(){this.m(1,0)},O:function(){var a=this.d.a,b=a[0].x,c=a[0].y;this.t(a.map(function(a){return{x:a.y-c+b,y:-(a.x-b)+c}}))},I:function(){this.n()},H:function(){for(;this.n(););}};return{l:function(){f.S=setTimeout("g.l()",f.G-f.h);f.n()},F:function(a){var b={c:a.getContext("2d"),v:function(a, b,c,e){var d=this.c;d.strokeStyle="#fff";d.lineWidth=1;d.strokeRect(a,b,c,e)},s:function(a,b,c){var d=this.c;d.fillStyle="#fff";d.fillText(a,b,c)},B:function(a,b,c,d,e){var f=this.c;f.fillStyle=e;f.fillRect(a,b,c,d)}};b.c.font="20pt Arial";b.c.textAlign="end";f=a={f:b,T:[],d:m,e:m,h:0,G:500,u:function(a){f.f.c.clearRect(this.D,320,this.C,40);b.s(a,d.o-25,350)}};for(var c=d.j,e=d.i,k=[],i=d.k-5-c,h=0;h<23;h++){for(var j=[],l=0;l<e;l++){var o={empty:!0,color:m,x:l*c+5,y:i-h*c};o.__proto__=p;j.push(o)}k.push(j)}a.p= k;for(var k=[],e=c*e+15,i=d.N,q=d.M,r=5+c*q,h=0;h<q;h++){j=[];for(l=0;l<i;l++)o={empty:!0,color:m,x:l*c+5+e,y:r-h*c},o.__proto__=p,j.push(o);k.push(j)}a.L=k;a.__proto__=d;a.w();a.u(a.h);return a}}}(Math);window.onload=function(){var e=g.F(document.getElementById("c"));document.addEventListener("keydown",function(i){switch(i.keyCode){case 13:e.H();break;case 37:e.J();break;case 38:e.O();break;case 39:e.K();break;case 40:e.I()}},!1);e.R()};