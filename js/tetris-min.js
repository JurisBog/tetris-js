var k=null; window.gameManager=function(){var e=[{color:"#f00",a:[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:1}]},{color:"#0f0",a:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:-1,y:0}]},{color:"#00f",a:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}]},{color:"#ff0",a:[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:-1,y:1}]},{color:"#fff",a:[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:1,y:1}]},{color:"#0ff",a:[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:-1,y:0}]},{color:"#f0f",a:[{x:0,y:0},{x:0,y:1},{x:-1,y:1},{x:1,y:0}]}],d=k,o={q:"#000",put:function(a){var b=d.g;typeof a=== "undefined"?(a=this.q,d.i.b.clearRect(this.x,this.y,b,b),this.empty=!0):(this.empty=!1,d.i.fillRect(this.x,this.y,b,b,a));this.color=a}},f={width:600,height:700,g:30,f:14,B:5,A:5,p:function(){var a=this.i,b=f.g*f.f;a.strokeRect(5,5,b,this.height-10);a.strokeRect(b+10,5,this.width-b-15,this.height-10);a.b.textAlign="left";a.fillText("NextPiece",b+25,30);a.b.textAlign="end"},D:function(){var a=this.k,b=[],c=0;a.forEach(function(a,i){a.every(function(a){return!a.empty})?c+=i+1:b.push(a)});b.forEach(function(b, c){a[c].forEach(function(a,c){var h=b[c];h.empty?a.put():a.put(h.color)})});a.slice(b.length).forEach(function(a){a.forEach(function(a){a.put()})});this.e+=c;this.C()},C:function(){this.o(this.e)},j:function(){var a=!0;this.h(0,-1)||(this.c.a.some(function(a){return a.y>=23})?(clearTimeout(this.F),alert("game over")):this.m(),a=!1);return a},l:function(){var a=Math.floor(Math.random()*e.length),b=this.d,c=this.z;b!=k&&b.a.forEach(function(a){c[a.y+2][a.x+2].put()});this.d=e[a];var d=this.d.color; this.d.a.forEach(function(a){c[a.y+2][a.x+2].put(d)});return b},m:function(){var a=this.l(),a={element:a,a:a.a.map(function(a){return{x:a.x+7,y:a.y+23}})};d.c=a;this.D()},n:function(a){var b=this.c,c=b.a,m=d.k,e=d.f,f;if(a.every(function(a){return a.y>=0&&a.x>=0&&a.x<e&&(a.y>=23||m[a.y][a.x].empty||c.some(function(b){return a.x===b.x&&a.y===b.y}))})){f=c.filter(function(b){return a.every(function(a){return!(a.x===b.x&&a.y===b.y)})});var g=a.filter(function(a){return c.every(function(b){return!(b.x=== a.x&&b.y===a.y)})});f.forEach(function(a){a.y<23&&m[a.y][a.x].put()});g.forEach(function(a){a.y<23&&m[a.y][a.x].put(b.element.color)});b.a=a;f=!0}else f=!1;return f},h:function(a,b){return this.n(this.c.a.map(function(c){return{x:c.x+a,y:c.y+b}}))},start:function(){this.l();this.m();gameManager.loop()},v:function(){this.h(-1,0)},w:function(){this.h(1,0)},rotate:function(){var a=this.c.a,b=a[0].x,c=a[0].y;this.n(a.map(function(a){return{x:a.y-c+b,y:-(a.x-b)+c}}))},u:function(){this.j()},t:function(){for(;this.j();); }};return{loop:function(){d.F=setTimeout("gameManager.loop()",d.s-d.e);d.j()},r:function(a){var b={b:a.getContext("2d"),strokeRect:function(a,b,c,e){var d=this.b;d.strokeStyle="#fff";d.lineWidth=1;d.strokeRect(a,b,c,e)},fillText:function(a,b,c){var d=this.b;d.fillStyle="#fff";d.fillText(a,b,c)},fillRect:function(a,b,c,d,e){var f=this.b;f.fillStyle=e;f.fillRect(a,b,c,d)}};b.b.font="20pt Arial";b.b.textAlign="end";d=a={i:b,G:[],c:k,d:k,e:0,s:500,o:function(a){b.fillText(a,f.width-25,350)}};for(var c= f.g,e=f.f,i=[],n=f.height-5-c,g=0;g<23;g++){for(var h=[],j=0;j<e;j++){var l={empty:!0,color:k,x:j*c+5,y:n-g*c};l.__proto__=o;h.push(l)}i.push(h)}a.k=i;for(var i=[],e=c*e+15,n=f.B,p=f.A,q=5+c*p,g=0;g<p;g++){h=[];for(j=0;j<n;j++)l={empty:!0,color:k,x:j*c+5+e,y:q-g*c},l.__proto__=o,h.push(l);i.push(h)}a.z=i;a.o(a.e);a.__proto__=f;a.p();return a}}}(); window.onload=function(){var e=gameManager.r(document.getElementById("c"));document.addEventListener("keydown",function(d){switch(d.keyCode){case 13:e.t();break;case 37:e.v();break;case 38:e.rotate();break;case 39:e.w();break;case 40:e.u()}},!1);e.start()};